<style type="text/css">
/*提示：如果你看到了这行文字，那说明您的预览器不支持内嵌 CSS 代码，请使用 VSCode 阅读本 Markdown 文件*/

body{font-size:15px;color:#333;background:#fff;font-family:Helvetica, Arial, "PingFang SC", "Microsoft YaHei", "WenQuanYi Micro Hei", "tohoma,sans-serif";margin:0;padding:10%}h1{font-size:2.2em;font-weight:700;line-height:1.1;padding-top:16px;margin-bottom:4px}h2, h3, h4, h5, h6{line-height:1.5em;margin-top:2.2em;margin-bottom:4px}h2{color:#ffffff !important;background-color:#ff9b98;border-left:12px solid #FF7E79;padding :1px 1px 1px 20px}h3{font-weight:700;font-size:1.2em;line-height:1.4;margin:10px 0 5px;padding-top:10px}h4{font-weight:700;text-transform:uppercase;font-size:1.1em;line-height:1.4;margin:10px 0 5px;padding-top:10px}h5, h6{font-size:.9em}h5{font-weight:bold;text-transform:uppercase}h6{font-weight:normal;color:#AAA}img{width:100%;border-radius:5px;display:block;margin-bottom:15px;height:auto}dl, ol, ul{margin-top:12px;margin-bottom:20px;padding-left:5%;line-height:1.8}p{margin:0 0 20px;padding:0;line-height:1.8}a{color:#f22f27;text-decoration:none}a:hover{color:#f55852;text-decoration:underline}a:focus{outline-offset:-2px}blockquote{font-size:1em;font-style:normal;padding:30px 38px;margin:0 0 15px;position:relative;line-height:1.8;text-indent:0;border:none;color:#888}blockquote:before{content:"“";left:12px;top:0;color:#E0E0E0;font-size:4em;font-family:Arial, serif;line-height:1em;font-weight:700;position:absolute}blockquote:after{content:"”";right:12px;bottom:-26px;color:#E0E0E0;font-size:4em;font-family:Arial, serif;line-height:1em;font-weight:700;position:absolute;bottom:-31px}strong, dfn{font-weight:700}em, dfn{font-style:italic;font-weight:400}del{text-decoration:line-through}pre{margin:0 0 10px;font-size:13px;line-height:1.42857;word-break:break-all;word-wrap:break-word;border-radius:4px;white-space:pre-wrap;display:block;background:#f8f8f8;padding:10px 20px;border:none;margin-bottom:25px;color:#666;font-family:Courier, sans-serif}code{color:#c7254e;background-color:#f9f2f4;border-radius:4px;font-family:Menlo, Monaco, Consolas, "Courier New", monospace;padding:2px 4px;font-size:90%}p>code{color:#c7264e;background-color:#f9f2f4;font-size:.95em;border-radius:3px;-moz-border-radius:3px;-webkit-border-radius:3px}figure{margin:1em 0}figcaption{font-size:0.75em;padding:0.5em 2em;margin-bottom:2em}figure img{margin-bottom:0px}hr{border:0;height:1px;background:#333;background-image:linear-gradient(to right, #ccc, #333, #ccc)}ol p, ul p{margin-bottom:0px}li{margin-bottom:0.75em;margin-top:0.75em}ol#footnotes{font-size:0.95em;padding-top:1em;margin-top:1em;margin-left:0;border-top:1px solid #eaeaea;counter-reset:footer-counter;list-style:none;color:#555;padding-left:5%;margin:20px 0}ol#footnotes li{margin-bottom:10px;margin-left:16px;font-weight:400;line-height:2;list-style-type:none}ol#footnotes li:before{content:counter(footer-counter) ". ";counter-increment:footer-counter;font-weight:800;font-size:.95em}@keyframes highfade{0%{background-color:none}20%{background-color:yellow}100%{background-color:none}}@-webkit-keyframes highfade{0%{background-color:none}20%{background-color:yellow}100%{background-color:none}}a:target, ol#footnotes li:target, sup a:target{animation-name:highfade;animation-duration:2s;animation-iteration-count:1;animation-timing-function:ease-in-out;-webkit-animation-name:highfade;-webkit-animation-duration:2s;-webkit-animation-iteration-count:1;-webkit-animation-timing-function:ease-in-out}a:target{border:0;outline:0}animation-iteration-count:1;-webkit-animation-timing-function:ease-in-out}a:target{border:0;outline:0}tion-iteration-count:1;-webkit-animation-timing-function:ease-in-out}a:target{border:0;outline:0}
</style>
<div align="center">
<h1><font  color="#ff7e79"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-bookmark-check-fill" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M2 15.5V2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v13.5a.5.5 0 0 1-.74.439L8 13.069l-5.26 2.87A.5.5 0 0 1 2 15.5zm8.854-9.646a.5.5 0 0 0-.708-.708L7.5 7.793 6.354 6.646a.5.5 0 1 0-.708.708l1.5 1.5a.5.5 0 0 0 .708 0l3-3z"/>
</svg>
每天一个技术点</font>
</h1>
<h6>
(2023.7.17)软件加密与解密-1-Windows-基本逆向方法前言[XDbg]
</h6>
</div>

<HR>

<h3>
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person-fill" viewBox="0 0 16 16">
  <path d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H3Zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"/>
</svg>
本文作者：XDbgPYG(小吧唧)
<br>
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-calendar2-event-fill" viewBox="0 0 16 16">
  <path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zm9.954 3H2.545c-.3 0-.545.224-.545.5v1c0 .276.244.5.545.5h10.91c.3 0 .545-.224.545-.5v-1c0-.276-.244-.5-.546-.5zM11.5 7a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1z"/>
</svg>
发布时间：2023年7月17日

<br>

<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-book-fill" viewBox="0 0 16 16">
  <path d="M8 1.783C7.015.936 5.587.81 4.287.94c-1.514.153-3.042.672-3.994 1.105A.5.5 0 0 0 0 2.5v11a.5.5 0 0 0 .707.455c.882-.4 2.303-.881 3.68-1.02 1.409-.142 2.59.087 3.223.877a.5.5 0 0 0 .78 0c.633-.79 1.814-1.019 3.222-.877 1.378.139 2.8.62 3.681 1.02A.5.5 0 0 0 16 13.5v-11a.5.5 0 0 0-.293-.455c-.952-.433-2.48-.952-3.994-1.105C10.413.809 8.985.936 8 1.783z"/>
</svg>
内容概要：软件保护技术介绍

</h3>

![](https://easyx-1314999863.cos.ap-nanjing.myqcloud.com/(2023.7.17)%E8%BD%AF%E4%BB%B6%E5%8A%A0%E5%AF%86%E4%B8%8E%E8%A7%A3%E5%AF%86-1-%E8%BD%AF%E4%BB%B6%E4%BF%9D%E6%8A%A4%E6%8A%80%E6%9C%AF%5BXDbg%5D-1.png)
## 1. 隐蔽软件技术/软件保护技术介绍
《软件加密与解密》（Surreptitious Software_ Obfuscation） 一书中介绍了如下几种技术。
1. 攻击和防御（与设计模式类似，可以称其为设计模式）
2. 程序分析方法
3. 代码混淆
4. 防篡改技术（文件校验、内存校验、反模拟器、反调试）
5. 软件水印
6. 软件相似性比对
7. 硬件保护技术 （不讲，没那环境）
8. 网络验证（原文中没有）

对于这些技术的讲解，我们把对软件进行保护的操作，统称为 “加壳”，对这些保护技术进行过程，统称为 “脱壳”。


## 2. 为什么要使用软件保护技术
1. 防止软件的核心被窃取，比如某家大公司派出了逆向小组对你的国产软件进行逆向，并发布了某母版/正版软件（盗版）。官司估计你是打不赢的（you will still not prevail in court unless you have the financial backing to outlast them through the appeals process.）
2. 制作病毒时，防止被杀毒软件检测。
3. 国防。比如：Cousot公司拥有软件水印算法（Partrick Cousot And Redhia Cousot. An abstract interpretation-based framework for software watermarking. In POPL'04,Venice,Italy,2004 ACM.）就归属于世界上第九大国防工程承包商法国 Thales 集团。下面引用一段美军招标文件（2006）中有关AT（anti-tamper）技术研究的内容。
>
All U.S. Army Project Executive Offices (PEOs) and Project Managers (PMs) are now charged with executing Army and Department of Defense (DoD) AT policies in the design and implementation of their systems. Embedded software is at the core of modern weapon systems and is one of the most critical technologies to be protected. AT provides protection of U.S. technologies against exploitation via reverse engineering. Standard compiled code with no AT is easy to reverse engineer, so the goal of employed AT techniques will be to make that effort more difficult. In attacking software, reverse engineers have a wide array of tools available to them, including debuggers, decompilers, disassemblers, as well as static and dynamic analysis techniques. AT techniques are being developed to combat the loss of the U.S. technological advantage, but further advances are necessary to provide useful, effective and varied toolsets to U.S. Army PEOs and PMs. ... The goal of software AT technologies/techniques developed is to provide a substantial layer of protection against reverse engineering, allowing for maximum delay in an adversary compromising the protected code. This capability will allow the U.S. time to advance its own technology or otherwise mitigate any losses of weapons technologies. As a result, the U.S. Army can continue to maintain a technological edge in support of its warfighters.

4. 为了客户，为了掐钱~

## 3. 为什么不使用软件保护技术
听一位从事游戏开发的朋友说，某家游戏公司为了杜绝外挂，给很多函数添加 VMP 保护，一天之间，游戏垮台了。（在这里讲个笑话）
>
On the downside, adding software protection to your program can cause problems in terms of cost, performance, a more complex software development cycle, and last but not least, annoyance to your legitimate users.


## 4. 攻击和防御模型
引入一个概念，叫做 “攻击/防御模型” 。

防御模型即在编写软件保护时假设攻击者的水平、攻击方式、组织能力。防御模型在密码学研究中，我们通常假设如下条件
1. 攻击者拿不到秘钥
2. 攻击者因式分解能力没我强（非对称加密）
3. 他没我聪明

防御模型的例子：
>看雪论坛搜索： 
>看雪CTF从入门到存活系列

在此，推荐看雪 密码学板块 这里有着丰富、激烈的思想碰撞，对于大家学习逆向有不错的帮助。
当然，大家如果在讨论希望遵守规则。
1. 灯，不拨不亮；
2. 理，不辨不明。
3. 我们不害怕争论，但需要理性地争论。
4. 我们不害怕被驳倒，但希望被理性地说服。

看雪-密码学板块：https://bbs.kanxue.com/forum-132.htm

看场雪前辈：https://bbs.kanxue.com/homepage-post-697893-1.htm

攻击模型例子：
在 IDA 中个静态分析工具中提供了所识别的函数列表，其中信息包括
1. 函数首地址
2. 函数大小
3. 函数参数
4. 函数属性

这四个信息就可以演变为四种攻击模型，甚至演变为组合技，产生多种攻击模型。
![](https://easyx-1314999863.cos.ap-nanjing.myqcloud.com/(2023.7.17)%E8%BD%AF%E4%BB%B6%E5%8A%A0%E5%AF%86%E4%B8%8E%E8%A7%A3%E5%AF%86-1-%E8%BD%AF%E4%BB%B6%E4%BF%9D%E6%8A%A4%E6%8A%80%E6%9C%AF%5BXDbg%5D-2.png)

当然，攻击模型的产生方式多样，我们可以通过自己的经验（研究方向）去创造出属于自己的攻击模型。（像不像设计模式？哈哈。）

## 5. 程序分析方法
分为静态分析和动态分析。
在这里不过多解释了~

## 6. 代码混淆
代码混淆这一技术是一把双刃剑
1. 保护病毒而不被杀软发现
2. 维护正版软件的版权使其不被侵害

代码混淆软件：VMP、SE、TMD、SP等

代码混淆开源：OLLVM、ADVobfuscator-master、movfuscator等

混淆呢，就是把代码变成难以被对手理解的样子。（变的连他亲妈都不认识~）

混淆例子：
[52pojie论坛中看到的一个例子](https://www.52pojie.cn/thread-1807744-1-1.html)

在这个程序中，程序的导出表遭到了混淆。使得 IDA 识别符号出了问题。似乎是添加了 65535 个无意义符号。
![](https://easyx-1314999863.cos.ap-nanjing.myqcloud.com/(2023.7.17)%E8%BD%AF%E4%BB%B6%E5%8A%A0%E5%AF%86%E4%B8%8E%E8%A7%A3%E5%AF%86-1-%E8%BD%AF%E4%BB%B6%E4%BF%9D%E6%8A%A4%E6%8A%80%E6%9C%AF%5BXDbg%5D-3.png)

[叹息之墙分析](https://bbs.kanxue.com/thread-247108.htm)
![](https://easyx-1314999863.cos.ap-nanjing.myqcloud.com/(2023.7.17)%E8%BD%AF%E4%BB%B6%E5%8A%A0%E5%AF%86%E4%B8%8E%E8%A7%A3%E5%AF%86-1-%E8%BD%AF%E4%BB%B6%E4%BF%9D%E6%8A%A4%E6%8A%80%E6%9C%AF%5BXDbg%5D-5.png)


在上面俩个例子中，我们看到了符号混淆、控制流混淆。
还差个数据流混淆。
当然，日后如有新发现，将回来添加。

## 7. 防篡改技术
1. 文件校验
2. 内存校验
3. 反调试
4. 反 CPU 模拟器

## 8. 软件水印
1. Windows的数字签名
2. 控制流图
3. 你在学习时做的笔记
4. 更多。。。。

这个开源项目的功能就能当做一个水印功能，当然，解决掉它的方法也很简单：直接给这个函数添加个混淆就好了。
[REpsych](https://github.com/xoreaxeaxeax/REpsych)
![](https://easyx-1314999863.cos.ap-nanjing.myqcloud.com/(2023.7.17)%E8%BD%AF%E4%BB%B6%E5%8A%A0%E5%AF%86%E4%B8%8E%E8%A7%A3%E5%AF%86-1-%E8%BD%AF%E4%BB%B6%E4%BF%9D%E6%8A%A4%E6%8A%80%E6%9C%AF%5BXDbg%5D-4.png)

## 9.代码相似性对比
1. IDA FLAIR
2. BinDiff（支持 IDA）
3. beyond compare
4. E-Debug（易语言分析插件）

代码相似性对比可以用来辅助分析，也可以用来取证~

## 10.基于硬件的保护技术
略，没有研究过。也许日后会回来补充。

## 书籍下载
[Z-lib 下载](https://cloudflare-ipfs.com/ipfs/bafykbzaced5nnhxdzfpzqqrnxjauxv4avhxfixja5jwkmnnwksthsoevo62dg?filename=Surreptitious%20Software%3A%20Obfuscation%2C%20Watermarking%2C%20and%20Tamperproofing%20for%20Software%20Protection_Christian%20Collberg%2C%20Jasvir%20Nagra.epub)


[在线阅读本篇随笔](https://easyx-1314999863.cos.ap-nanjing.myqcloud.com/(2023.7.17)%E8%BD%AF%E4%BB%B6%E5%8A%A0%E5%AF%86%E4%B8%8E%E8%A7%A3%E5%AF%86-1-%E8%BD%AF%E4%BB%B6%E4%BF%9D%E6%8A%A4%E6%8A%80%E6%9C%AF%5BXDbg%5D.html)
